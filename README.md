# Arduino RS485 Doorbell System

This project implements a RS485-based doorbell communication system using Arduino. It handles bidirectional communication between devices using the RS485 protocol with even parity.

## Hardware Requirements

- Arduino board (e.g., Arduino Uno, Nano, etc.)
- MAX485 module (or similar RS485 transceiver)
- Doorbell system compatible with RS485 communication

The MAX485 adapter board is also open source and available on [OSHWHub]( https://oshwhub.com/jas0n1ee/arduino_nano_dcdc_485_board)

### Pin Connections

| Arduino Pin | Connection      |
|------------|-----------------|
| Pin 2(RX)      | RS485 TX       |
| Pin 3(TX)      | RS485 RX       |
| Pin 4(EN)      | RS485 EN/DE    |
| 5V         | 5V    |
| GND        | GND      |

## Software Dependencies

- [SoftwareSerialParity](https://github.com/yourusername/SoftwareSerialParity) library for handling serial communication with parity

## Features

- Bidirectional RS485 communication with even parity
- State machine implementation (IDLE, RING, SPEAKING states)
- Automatic handling of various doorbell commands:
  - Discovery
  - Ring detection
  - Call pickup
  - Door unlock
  - Call hangup
- Debug output via hardware serial
- Configurable unlock count limit (default: 5 attempts)

## Protocol Implementation

The system implements a custom protocol with 4-byte messages. Key message types include:

- H_DISCOVER / C_IMHERE: Device discovery
- H_RING / C_RINGACK: Ring detection and acknowledgment
- H_PKUPACK / C_SPKING: Call pickup handling
- C_UNLOCK / H_UNLOCKACK: Door unlock commands
- HHB / CHB: Heartbeat messages
- Various other control and status messages

## Installation

1. Install the SoftwareSerialParity library in your Arduino IDE
2. Connect the hardware according to the pin connection table
3. Upload the sketch to your Arduino board

## Usage

The system automatically:
- Responds to discovery requests
- Handles incoming rings
- Manages call states
- Controls door unlocking
- Maintains communication through heartbeat messages

Debug information is output to the Serial Monitor at 9600 baud.

## State Machine

The system operates in three states:
- IDLE: Default state, waiting for events
- RING: Active when doorbell is rung
- SPEAKING: Active during a call session

## Contributing

Feel free to submit issues and enhancement requests!

## License

MIT

## CODE WRITTEN BY AI

All the hex command code are reverse engineered by the human writter with oscilloscope and logic analyzer.  
The draft python code is partially written by the human writter with Cursor auto-completion.  
The arduino code is translated from the python code by Cursor composer with human debugging.  
This README is generated by Cursor composer with human editing.  
